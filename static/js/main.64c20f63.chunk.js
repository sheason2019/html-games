(this.webpackJsonpchannel=this.webpackJsonpchannel||[]).push([[0],{36:function(e,n,t){},37:function(e,n,t){},46:function(e,n,t){"use strict";t.r(n);var r=t(1),o=t.n(r),c=t(22),i=t.n(c),a=(t(36),t(37),t(18)),l=t(7),u=t(2),s=t(3),f=t(4),d=t(17);function m(){for(var e=[],n=0;n<8;n++)e.push([]);return e}function h(){for(var e=[],n=0;n<4;n++)e.push(null);return e}function p(){for(var e=[],n=0;n<4;n++)e.push([]);return e}var b,j,x,g,v={time:0,slots:h(),collections:p(),columns:m(),temp:{index:-1,stack:[],type:"column"},start:!1,status:"index",message:{open:!1,text:"",message_id:0},history:[],justCancel:!1,blockAutoCollection:!1},O=Object(d.b)({name:"cells",initialState:v,reducers:{initColumn:function(e){for(var n=function(){for(var e=[],n=0;n<13;n++)for(var t=0;t<4;t++)e.push({value:n,color:t});return e}(),t=m(),r=0;n.length>0;){var o=Math.floor(Math.random()*n.length),c=n.splice(o,1)[0];t[r++].push(c),r>7&&(r=0)}e.columns=t,e.history=[],e.collections=p(),e.slots=h(),e.time=0,e.start=!1,e.blockAutoCollection=!1},selectColumn:function(e,n){Object.assign(e.temp,n.payload,{timeStamp:Date.now()})},moveCard:function(e,n){var t=n.payload,r=t.target,o=t.length,c=function(e,n,t){var r=e.filter((function(e){return null===e})).length,o=n.filter((function(e,n){return 0===e.length&&n!==t})).length;return(r+1)*Math.pow(2,o)}(e.slots,e.columns,r);if(-1!==e.temp.index){if(o>c&&0!==e.columns[r].length)return e.message.open=!0,e.message.text="\u79fb\u52a8\u5361\u724c\u5931\u8d25\uff0c\u60a8\u8bd5\u56fe\u79fb\u52a8".concat(o,"\u5f20\u724c\uff0c\u4f46\u73b0\u5728\u53ea\u80fd\u79fb\u52a8").concat(c,"\u5f20"),void(e.message.message_id=(new Date).getTime());if("column"===e.temp.type){for(var i=[],a=0;a<Math.min(o,c);a++){var l=e.columns[e.temp.index].pop();i.push(l)}i.reverse();for(var u=0,s=i;u<s.length;u++){var f=s[u];e.columns[r].push(f)}e.temp={index:-1,stack:[]}}else"slot"===e.temp.type&&(e.columns[r].push(e.slots[e.temp.index]),e.slots[e.temp.index]=null);e.start=!0,e.blockAutoCollection=!1}},moveToSlot:function(e,n){var t=n.payload.target;if(0!==e.temp.stack.length&&null===e.slots[t]){var r;if("column"===e.temp.type)r=e.columns[e.temp.index].pop();else{if("slot"!==e.temp.type)return;r=e.slots[e.temp.index],e.slots[e.temp.index]=null}e.slots[t]=r,e.temp.index=-1,e.temp.stack=[],e.start=!0,e.blockAutoCollection=!1}},moveToCollection:function(e,n){var t=n.payload.target,r=e.temp.index;if(0!==e.temp.stack.length){var o;"slot"===e.temp.type?(e.slots[r],o=e.slots[r],e.slots[r]=null):"column"===e.temp.type&&(o=e.columns[r].pop()),e.collections[t].push(o),e.temp={index:-1,stack:[]},e.start=!0,e.blockAutoCollection=!1;var c=!0;e.collections.forEach((function(e){0!==e.length&&12!==e[e.length-1].value&&(c=!1)})),e.start=!c,c&&(e.status="end",localStorage.setItem("completePatch",parseInt(localStorage.getItem("completePatch"))+1))}},setTime:function(e,n){e.time=n.payload},setMessage:function(e,n){Object.assign(e.message,n.payload)},setStatus:function(e,n){e.status=n.payload},pushIntoHistory:function(e,n){e.justCancel?e.justCancel=!1:e.start?e.history.push(n.payload):e.history[0]=n.payload},cancelAction:function(e,n){if("end"!==e.status&&e.history.length>1){var t=n.payload;e.history.pop(),e.collections=Object.assign([],t.collections),e.columns=Object.assign([],t.columns),e.slots=Object.assign([],t.slots),e.justCancel=!0,e.blockAutoCollection=!0,e.temp={index:-1,stack:[],type:"column"}}}}}),w=O.actions,y=w.initColumn,k=w.selectColumn,C=w.moveCard,M=w.moveToSlot,S=w.moveToCollection,E=w.setTime,R=w.setMessage,F=w.setStatus,I=w.cancelAction,H=w.pushIntoHistory,T=O.reducer,A=t(8),W=t(0),z=s.a.div(b||(b=Object(u.a)(["\n  width: 8rem;\n  height: 10rem;\n  background-color: white;\n  border-radius: 0.5rem;\n  margin-bottom: ",";\n  box-shadow: ",";\n  position: relative;\n  overflow: hidden;\n"])),(function(e){return e.last?0:"-7rem"}),(function(e){return e.selected?"0px 1px 2px 4px rgba(0, 0, 0, 0.5)":"0px 1px 2px 0px rgba(0, 0, 0, 0.75)"})),L=s.a.div(j||(j=Object(u.a)(["\n  font-size: 1.25rem;\n  display: flex;\n  padding-top: 0.25rem;\n  padding-left: 0.25rem;\n  color: ",";\n  user-select: none;\n"])),(function(e){return e.color%2===0?"black":"red"})),P=s.a.div(x||(x=Object(u.a)(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 1.25rem;\n"]))),N=s.a.div(g||(g=Object(u.a)(["\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background-color: rgba(0, 0, 0, 0.25);\n  visibility: ",";\n"])),(function(e){return e.open?"normal":"hidden"})),K=["\u2660","\u2665","\u2663\ufe0f","\u2666\ufe0f"],J=function(e){switch(e){case 0:return"A";case 10:return"J";case 11:return"Q";case 12:return"K";default:return String(e+1)}};var D,U,_,B,q,G=function(e){var n=o.a.useRef(),t=o.a.useState(!1),r=Object(A.a)(t,2),c=r[0],i=r[1];return Object(W.jsxs)(z,{ref:n,shouldMove:c,selected:e.selected,last:e.last,onMouseMove:function(e){},onMouseDown:function(){i(!0)},onMouseUp:function(){i(!1)},children:[Object(W.jsx)(N,{open:e.backdrop}),Object(W.jsxs)(L,{color:e.data.color,children:[Object(W.jsx)(P,{color:e.data.color,children:K[e.data.color]}),Object(W.jsx)("span",{children:J(e.data.value)})]})]})},Z=s.a.div(D||(D=Object(u.a)(["\n  width: 8rem;\n  height: 10rem;\n  margin: 5px;\n  border: 1px solid white;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: relative;\n  border-radius: 0.5rem;\n  user-select: none;\n"]))),Y=s.a.div(U||(U=Object(u.a)(["\n  display: flex;\n  padding: 5px;\n"]))),Q=s.a.div(_||(_=Object(u.a)(["\n  color: ",";\n  font-size: 5rem;\n  opacity: 0.25;\n"])),(function(e){return e.index%2===0?"black":"red"}));function $(){var e=Object(f.c)((function(e){return e.cells.collections})),n=Object(f.c)((function(e){return e.cells.temp})),t=Object(f.b)();return Object(W.jsx)(Y,{children:e.map((function(r,o){return Object(W.jsx)(Z,{onClick:function(r){return function(r,o){r.stopPropagation();var c=e[o],i=n.stack[n.stack.length-1];i&&(i.color===o&&i.value===c.length&&t(S({target:o})),t(k({index:-1,stack:[]})))}(r,o)},children:Object(W.jsx)(V,{collection:r,index:o})},o)}))})}function V(e){var n=e.index,t=e.collection;return 0===t.length?Object(W.jsx)(Q,{index:n,children:["\u2660","\u2665","\u2663\ufe0f","\u2666\ufe0f"][n]}):Object(W.jsx)("div",{style:{position:"absolute",zIndex:t.value,top:0},children:Object(W.jsx)(G,{data:t[t.length-1]})})}var X,ee,ne,te,re=s.a.div(B||(B=Object(u.a)(["\n  width: 8rem;\n  height: 10rem;\n  margin: 5px;\n  border: 1px solid white;\n  border-radius: 0.5rem;\n"]))),oe=s.a.div(q||(q=Object(u.a)(["\n  display: flex;\n  padding: 5px;\n"])));function ce(){var e=Object(f.b)(),n=Object(f.c)((function(e){return e.cells.slots})),t=Object(f.c)((function(e){return e.cells.temp})),r=Object(f.c)((function(e){return e.cells.collections})),c=Object(f.c)((function(e){return e.cells.start})),i=Object(f.c)((function(e){return e.cells.blockAutoCollection})),a=o.a.useCallback((function(t){null===n[t]?e(M({target:t})):e(k({index:t,stack:[n[t]],type:"slot"}))}),[e,n]),l=o.a.useCallback((function(){if(!i){var t=12;r.forEach((function(e){0===e.length?t=0:e[e.length-1].value<t&&(t=e[e.length-1].value)})),n.forEach((function(n,o){if(null!==n&&!(n.value>=t+2)){var c=r[n.color];0===c.length?0===n.value&&(a(o),e(S({target:n.color}))):c[c.length-1].value+1===n.value&&(a(o),e(S({target:n.color})))}}))}}),[r,e,a,n]);return o.a.useEffect((function(){c&&l()}),[l,c]),Object(W.jsx)(oe,{children:n.map((function(e,n){return Object(W.jsx)(re,{onClick:function(e){a(n),e.stopPropagation()},children:null===e?null:Object(W.jsx)(G,{data:e,selected:"slot"===t.type&&t.index===n})},n)}))})}var ie,ae,le,ue,se,fe,de=s.a.div(X||(X=Object(u.a)(["\n  display: flex;\n  margin-top: 4.5rem;\n\n  @media (max-width: 960px) {\n    transform: scale(0.5);\n    margin-top: -2rem;\n  }\n"]))),me=s.a.div(ee||(ee=Object(u.a)(["\n  width: 12rem;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n"]))),he=s.a.div(ne||(ne=Object(u.a)(["\n  font-size: 24px;\n  font-weight: 600;\n  user-select: none;\n"]))),pe=s.a.div(te||(te=Object(u.a)(["\n  background-color: rgba(0,0,0,0.25);\n  width: 80%;\n  height: 3rem;\n  color: rgba(255,255,255,0.9);\n  font-size: 2.5rem;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin-top: 1rem;\n  user-select: none;\n"])));function be(){var e=Object(f.c)((function(e){return e.cells.time})),n=Object(f.c)((function(e){return e.cells.start})),t=Object(f.b)();return o.a.useEffect((function(){n&&setTimeout((function(){t(E(e+1))}),1e3)}),[t,n,e]),Object(W.jsxs)(de,{children:[Object(W.jsx)(ce,{}),Object(W.jsxs)(me,{children:[Object(W.jsx)(he,{children:"Time"}),Object(W.jsxs)(pe,{children:[Math.floor(e/60),":",e%60<10?"0"+e%60:e%60]})]}),Object(W.jsx)($,{})]})}var je=s.a.div(ie||(ie=Object(u.a)(["\n  flex-grow: 1;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n"]))),xe=s.a.div(ae||(ae=Object(u.a)(["\n  padding: 1.5rem;\n  width: 35rem;\n  background-color: rgba(0, 0, 0, 0.5);\n  border: 2px solid #000;\n  margin: 0.5rem 0;\n  border-radius: 4px;\n  color: white;\n  user-select: none;\n  p {\n    margin: 0;\n  }\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n"]))),ge=s.a.div(le||(le=Object(u.a)(["\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  width: 80%;\n"]))),ve=s.a.div(ue||(ue=Object(u.a)(["\n  display: flex;\n  justify-content: space-between;\n"]))),Oe=s.a.div(se||(se=Object(u.a)(["\n  width: 80%;\n  height: 3rem;\n  margin-top: 1rem;\n  background-color: #1b7ced;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 1.75rem;\n  border-radius: 4px;\n"]))),we=s.a.div(fe||(fe=Object(u.a)(["\n  width: 80%;\n  height: 2rem;\n  margin-top: 1rem;\n  background-color: #e44c51;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 1.25rem;\n  border-radius: 4px;\n"])));var ye,ke=function(){var e=Object(f.c)((function(e){return e.cells.time})),n=o.a.useRef(0),t=Object(f.b)();return o.a.useEffect((function(){n.current=localStorage.getItem("completePatch")}),[]),Object(W.jsx)(je,{children:Object(W.jsxs)(xe,{children:[Object(W.jsx)("h2",{style:{marginTop:0},children:"\u606d\u559c\u901a\u5173"}),Object(W.jsxs)(ge,{children:[Object(W.jsxs)(ve,{children:[Object(W.jsx)("p",{children:"\u65f6\u95f4"}),Object(W.jsx)("p",{children:e})]}),Object(W.jsxs)(ve,{children:[Object(W.jsx)("p",{children:"\u5df2\u5b8c\u6210\u573a\u6b21\uff1a"}),Object(W.jsx)("p",{children:n.current})]})]}),Object(W.jsx)(Oe,{onClick:function(){t(y()),t(F("game"))},children:"\u65b0\u7684\u6e38\u620f"}),Object(W.jsx)(we,{onClick:function(){t(y()),t(F("index"))},children:"\u8fd4\u56de\u83dc\u5355"})]})})},Ce=t(6),Me=s.a.div(ye||(ye=Object(u.a)(["\n  position: fixed;\n  right: ",";\n  bottom: ",";\n  left: ",";\n  top: ",";\n  width: 4rem;\n  height: 4rem;\n  border-radius: 2rem;\n  color: #FFF;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 20;\n  background-color: rgba(0,0,0,0.5);\n  border: 2px solid rgba(0,0,0,0.75);\n  &:hover {\n    background-color: rgba(0,0,0,0.75);\n    cursor: pointer;\n  }\n"])),(function(e){return e.right}),(function(e){return e.bottom}),(function(e){return e.left}),(function(e){return e.top}));var Se,Ee,Re,Fe=function(e){return Object(W.jsx)(Me,Object(Ce.a)(Object(Ce.a)({},e),{},{children:e.children}))},Ie=s.a.div(Se||(Se=Object(u.a)(["\n  margin: 0 0.75rem;\n  position: relative;\n  align-self: flex-start;\n"]))),He=s.a.div(Ee||(Ee=Object(u.a)(["\n  width: 8rem;\n  height: 10rem;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: relative;\n  border-radius: 0.5rem;\n  &:hover {\n    background-color: rgba(0, 0, 0, 0.1);\n    cursor: pointer;\n  }\n"])));function Te(e){var n=Object(f.b)(),t=Object(f.c)((function(e){return e.cells.temp})),r=Object(f.c)((function(e){return e.cells.collections})),c=Object(f.c)((function(e){return e.cells.slots})),i=Object(f.c)((function(e){return e.cells.columns})),a=Object(f.c)((function(e){return e.cells.start})),l=Object(f.c)((function(e){return e.cells.blockAutoCollection})),u=i[e.index],s=o.a.useCallback((function(r){r&&r.stopPropagation();var o=function(e,n){var t={allowMove:!1,length:0};if(0===n.length)return{allowMove:!0,length:e.length};var r=n[n.length-1];return e.forEach((function(n,o){n.color%2!==r.color%2&&n.value===r.value-1&&(t.allowMove=!0,t.length=e.length-o)})),t}(t.stack,u);if(o.allowMove)n(C({target:e.index,length:o.length}));else{var c=function(e){for(var n={},t=[],r=e.length,o=0;!(o>=r);){if(void 0===n.value)Object.assign(n,e[r-1]),o++;else{if(e[r-1-o].value!==n.value+1||e[r-1-o].color%2===n.color%2)break;Object.assign(n,e[r-1-o]),o++}t.unshift(Object.assign({},n))}return t}(u);n(k({index:e.index,stack:c,type:"column"}))}}),[u,n,e.index,t.stack]),d=o.a.useCallback((function(){n(k({index:-1,stack:[]}))}),[n]),m=function(n){return"column"===t.type&&(e.index===t.index&&!u.length-n<=t.stack.length)},h=o.a.useCallback((function(){if(!l){var t=i[e.index];if(0!==t.length){var o=t[t.length-1],c=r[o.color],a=13;r.forEach((function(e){0===e.length?a=0:e[e.length-1].value<a&&(a=e[e.length-1].value)})),o.value>=a+2||(0===c.length?0===o.value&&(s(),n(S({target:o.color}))):c[c.length-1].value+1===o.value&&(s(),n(S({target:o.color}))))}}}),[l,r,i,n,s,e.index]);return o.a.useEffect((function(){a&&h()}),[h,a]),Object(W.jsxs)(Ie,{onClick:s,onMouseUp:function(t){if(2===t.button){var o=function(){if(0===i[e.index].length)return!1;for(var n=0;n<c.length;n++)if(null===c[n])return{allow:!0,target:n};return{allow:!1}}();!function(){var n=i[e.index];if(0===n.length)return!1;var t=n[n.length-1],o=r[t.color];if(0===o.length){if(0===t.value)return!0}else if(o[o.length-1].value+1===t.value)return!0;return!1}()?o.allow&&(d(),s(),n(M({target:o.target}))):(d(),s(),n(S({target:u[u.length-1].color})))}},children:[0===u.length?Object(W.jsx)(He,{}):u.map((function(e,n){return Object(W.jsx)(G,{data:e,backdrop:m(n),last:n===u.length-1},n)})),Object(W.jsx)(Pe,{show:t.index===e.index&&"column"===t.type})]})}var Ae,We,ze,Le=s.a.div(Re||(Re=Object(u.a)(["\n  position: absolute;\n  top: ","rem;\n  box-shadow: 0px 1px 2px 4px rgba(0, 0, 0, 0.5);\n  border-radius: 0.5rem;\n"])),(function(e){return 3*e.space})),Pe=function(e){var n=Object(f.c)((function(e){return e.cells.temp})),t=Object(f.c)((function(e){return e.cells.columns})),r=Object(f.c)((function(e){return e.cells.collections})),o=Object(f.c)((function(e){return e.cells.slots})),c=t[n.index],i=t[n.index],a=Object(f.b)(),l=function(){console.log("on double click");var e=function(){if(0===i.length)return!1;for(var e=0;e<o.length;e++)if(null===o[e])return{allow:!0,target:e};return{allow:!1}}();!function(){if(0===i.length)return!1;var e=i[i.length-1],n=r[e.color];if(0===n.length){if(0===e.value)return!0}else if(n[n.length-1].value+1===e.value)return!0;return!1}()?e.allow&&a(M({target:e.target})):a(S({target:i[i.length-1].color}))};return e.show?Object(W.jsx)(Le,{onClick:function(e){e.stopPropagation();var t=n.timeStamp||0;Date.now()-t<300?l():a(k({index:-1,stack:[]}))},space:c.length-n.stack.length,children:n.stack.map((function(e,t){return Object(W.jsx)(G,{data:e,last:t===n.stack.length-1},t)}))}):null},Ne=s.a.div(Ae||(Ae=Object(u.a)(["\n  display: flex;\n  margin-top: 2rem;\n\n  @media (max-width: 960px) {\n    transform: scale(0.5);\n    margin-top: -2rem;\n    transform-origin: 50% 0;\n  }\n"])));function Ke(){var e=Object(f.c)((function(e){return e.cells.columns}));return Object(W.jsx)(Ne,{children:e.map((function(e,n){return Object(W.jsx)(Te,{index:n},n)}))})}var Je=s.a.div(We||(We=Object(u.a)(["\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  width: 100vw;\n  flex-grow: 1;\n"]))),De=s.a.div(ze||(ze=Object(u.a)(["\n  padding: 1.5rem;\n  width: 35rem;\n  background-color: rgba(0, 0, 0, 0.5);\n  border: 2px solid #000;\n  margin: 0.5rem 0;\n  border-radius: 4px;\n  color: white;\n  user-select: none;\n  @media(max-width: 960px) {\n    transform: scale(0.5);\n    transform-origin: 50% 10%;\n  }\n  p {\n    margin: 0;\n  }\n"])));var Ue,_e=function(){var e=Object(f.b)();return Object(W.jsx)(Je,{onClick:function(){e(F("index"))},children:Object(W.jsxs)(De,{children:[Object(W.jsx)("h3",{style:{textAlign:"center"},children:"\u5e2e\u52a9&\u4ecb\u7ecd"}),Object(W.jsx)("h4",{children:"\u6e38\u620f\u76ee\u6807"}),Object(W.jsx)("p",{children:"\u5728\u56db\u4e2a\u56de\u6536\u5355\u5143\u4e2d\u5404\u521b\u5efa\u4e00\u53e0\u724c\uff0c\u6bcf\u53e0 13 \u5f20\uff0c\u4e14\u82b1\u8272\u76f8\u540c\u3002\u6bcf\u53e0\u724c\u5fc5\u987b\u6309\u4ece\u5c0f (A) \u5230\u5927 (K) \u7684\u987a\u5e8f\u6392\u5217\u3002"}),Object(W.jsx)("h4",{children:"\u5982\u4f55\u73a9\u724c"}),Object(W.jsx)("p",{children:"\u7a7a\u5f53\u63a5\u9f99\u4ec5\u4f7f\u7528\u4e00\u526f\u724c\u73a9\uff0c\u5171 52 \u5f20\uff0c\u724c\u7684\u6b63\u9762\u671d\u4e0a\uff0c\u6392\u6210\u516b\u5217\u3002\u901a\u8fc7\u4ece\u8fd9\u516b\u5217\u4e2d\u79fb\u724c\u6765\u521b\u5efa\u56db\u53e0\u724c\uff1a"}),Object(W.jsx)("p",{children:"\u5de6\u4e0a\u89d2\u662f\u56db\u4e2a\u201c\u53ef\u7528\u5355\u5143\u201d\uff0c\u79fb\u724c\u65f6\u53ef\u4ee5\u5728\u5176\u4e2d\u4e34\u65f6\u653e\u724c\u3002"}),Object(W.jsx)("p",{children:"\u53f3\u4e0a\u89d2\u662f\u56db\u4e2a\u201c\u56de\u6536\u5355\u5143\u201d\uff0c\u5728\u5176\u4e2d\u6784\u5efa\u83b7\u80dc\u6240\u9700\u7684\u724c\u53e0\u3002"}),Object(W.jsx)("h4",{children:"\u5177\u4f53\u73a9\u6cd5"}),Object(W.jsx)("p",{children:"\u4ece\u6bcf\u5217\u5e95\u90e8\u62d6\u724c\uff0c\u5e76\u6309\u4ee5\u4e0b\u65b9\u5f0f\u79fb\u52a8\uff1a"}),Object(W.jsx)("p",{children:"\u4ece\u5217\u5230\u53ef\u7528\u5355\u5143\u3002\u6bcf\u4e2a\u53ef\u7528\u5355\u5143\u4e00\u6b21\u53ea\u80fd\u653e\u4e00\u5f20\u724c\u3002"}),Object(W.jsx)("p",{children:"\u4ece\u5217\u5230\u5217\uff08\u6216\u4ece\u53ef\u7528\u5355\u5143\u5230\u5217\uff09\u3002\u5728\u5217\u4e2d\u5fc5\u987b\u6309\u964d\u5e8f\u4f9d\u6b21\u653e\u724c\uff0c\u800c\u4e14\u7ea2\u9ed1\u82b1\u8272\u4ea4\u66ff\u3002"}),Object(W.jsx)("p",{children:"\u4ece\u5217\u5230\u56de\u6536\u5355\u5143\u3002\u6bcf\u53e0\u724c\u5fc5\u987b\u7531\u540c\u4e00\u82b1\u8272\u7ec4\u6210\uff0c\u5e76\u4ece A \u5f00\u59cb\u3002"}),Object(W.jsx)("p",{children:"\u6bcf\u4e00\u5217\u4e2d\u53ea\u80fd\u79fb\u52a8\u6700\u4e0b\u9762\u7684\u724c\uff0c\u88ab\u538b\u4f4f\u7684\u724c\u662f\u4e0d\u80fd\u76f4\u63a5\u79fb\u52a8\u7684\u3002\u5de6\u4e0a\u7684\u4e2d\u8f6c\u5355\u5143\u4e2d\u7684\u724c\u90fd\u53ef\u4ee5\u79fb\u52a8\u3002"}),Object(W.jsx)("p",{style:{textAlign:"center",marginTop:"2rem"},children:"*\u70b9\u51fb\u80cc\u666f\u4efb\u610f\u4f4d\u7f6e\u8fd4\u56de\u83dc\u5355*"})]})})},Be=(t(43),s.a.div(Ue||(Ue=Object(u.a)(["\n  position: fixed;\n  bottom: ",";\n  transition: 400ms;\n  left: 0;\n  right: 0;\n  height: 2.5rem;\n  width: 28rem;\n  background-color: rgb(211, 47, 47);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 10;\n  border-radius: 4px;\n  color: white;\n  margin: 0 auto;\n  box-shadow: 0px 3px 5px -1px rgb(0 0 0 / 20%),\n    0px 6px 10px 0px rgb(0 0 0 / 14%), 0px 1px 18px 0px rgb(0 0 0 / 12%);\n"])),(function(e){return e.open?"3rem":"-3rem"})));var qe,Ge,Ze=function(){var e=Object(f.c)((function(e){return e.cells.message})),n=o.a.useRef(null),t=o.a.useRef(null),r=Object(f.b)(),c=o.a.useCallback((function(){r(R({open:!1}))}),[r]);return o.a.useEffect((function(){null!==n.current&&clearTimeout(n.current),(e.open||e.message_id!==t.current)&&(n.current=setTimeout((function(){c()}),2e3),t.current=e.message_id)}),[c,e.message_id,e.open]),Object(W.jsx)(Be,{open:e.open,children:Object(W.jsx)("b",{style:{userSelect:"none"},children:e.text})})},Ye=s.a.div(qe||(qe=Object(u.a)(["\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  flex-grow: 1;\n"]))),Qe=s.a.div(Ge||(Ge=Object(u.a)(["\n  width: 25rem;\n  height: 3rem;\n  background-color: rgba(0, 0, 0, 0.5);\n  border: 2px solid #000;\n  margin: 0.5rem 0;\n  border-radius: 4px;\n  color: white;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  user-select: none;\n  opacity: ",";\n  ","\n"])),(function(e){return e.disable?.5:1}),(function(e){return e.disable?"cursor: not-allowed;":"\n    &:hover {\n      background-color: rgba(0, 0, 0, 0.75);\n      cursor: pointer;\n    }\n  "}));var $e,Ve=function(){var e=Object(f.b)(),n=Object(f.c)((function(e){return e.cells.status})),t=Object(l.f)();return Object(W.jsxs)(Ye,{children:[Object(W.jsx)(Qe,{onClick:function(){e(F("game"))},style:{display:"pause"===n?"static":"none"},children:"\u7ee7\u7eed\u6e38\u620f"}),Object(W.jsx)(Qe,{onClick:function(){e(F("game")),e(y())},children:"\u65b0\u7684\u6e38\u620f"}),Object(W.jsx)(Qe,{onClick:function(){e(F("help"))},children:"\u6e38\u620f\u5e2e\u52a9"}),Object(W.jsx)(Qe,{onClick:function(){t.push("/")},children:"\u9000\u51fa\u6e38\u620f"})]})},Xe=s.a.div($e||($e=Object(u.a)(["\n  width: 100vw;\n  height: 100vh;\n  overflow: hidden;\n  background-color: green;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n"])));var en,nn,tn,rn=function(){var e,n=Object(f.b)(),t=Object(f.c)((function(e){return e.cells.status})),r=Object(f.c)((function(e){return e.cells.history})),c=Object(f.c)((function(e){return e.cells})),i=o.a.useRef(new Map),a=function(e){e.stopPropagation(),r.length>1&&n(I(r[r.length-2]))};return o.a.useEffect((function(){n(y())}),[n]),o.a.useEffect((function(){n(H({columns:c.columns,slots:c.slots,collections:c.collections}))}),[c.columns,c.slots,c.collections,n]),o.a.useEffect((function(){return document.onkeydown=function(e){i.current.set(e.code,!0),i.current.get("ControlLeft")&&i.current.get("KeyZ")&&a(e)},document.onkeyup=function(e){i.current.set(e.code,!1)},function(){document.onkeydown=function(){},document.onkeyup=function(){}}})),"index"===t?e=Object(W.jsx)(Ve,{}):"game"===t?e=Object(W.jsxs)(W.Fragment,{children:[Object(W.jsx)(be,{}),Object(W.jsx)(Ke,{}),Object(W.jsx)(Ze,{}),Object(W.jsx)(Fe,{right:"1rem",bottom:"1rem",onClick:a,children:"\u64a4\u9500"}),Object(W.jsx)(Fe,{left:"1rem",bottom:"1rem",onClick:function(){n(F("pause"))},children:"\u83dc\u5355"})]}):"help"===t?e=Object(W.jsx)(_e,{}):"end"===t?e=Object(W.jsx)(ke,{}):"pause"===t&&(e=Object(W.jsx)(Ve,{})),Object(W.jsx)(Xe,{onClick:function(e){n(k({index:-1,stack:[]}))},onContextMenu:function(e){return e.preventDefault()},children:e})},on=s.a.div(en||(en=Object(u.a)(["\n  background: rgba(0,0,0, 0.5);\n  height: 4rem;\n  left: 0;\n  right: 0;\n  position: absolute;\n  z-index: 10;\n  color: #FFF;\n  display: flex;\n  align-items: center;\n  @media (max-width: 960px) {\n    display: none;\n  }\n"]))),cn=s.a.div(nn||(nn=Object(u.a)(["\n  font-size: 2rem;\n  font-family: '\u5fae\u8f6f\u96c5\u9ed1';\n  padding-left: 1rem;\n  user-select: none;\n"]))),an=s.a.div(tn||(tn=Object(u.a)(["\n  width: 3rem;\n  height: 2rem;\n  border: 1px solid rgba(255, 255, 255, 0.5);\n  margin-left: 1rem;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 1rem;\n  user-select: none;\n  border-radius: 4px;\n  &:hover {\n    background-color: rgba(255, 255, 255, 0.5);\n    color: black;\n    cursor: pointer;\n  }\n"])));var ln,un,sn,fn,dn=function(){return Object(W.jsxs)(on,{children:[Object(W.jsx)(an,{children:"Menu"}),Object(W.jsx)(cn,{children:"\u7a7a\u5f53\u63a5\u9f99"})]})},mn=t(21),hn=s.a.div(ln||(ln=Object(u.a)(["\n  display: flex;\n"]))),pn=s.a.div(un||(un=Object(u.a)(["\n  width: 4rem;\n  height: 4rem;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border: 1px solid black;\n"]))),bn=Object(s.a)(pn)(sn||(sn=Object(u.a)(["\n  background-color: gray;\n"]))),jn=Object(s.a)(pn)(fn||(fn=Object(u.a)([""])));function xn(e){var n=e.type;return 0===n?Object(W.jsx)(bn,{}):1===n?Object(W.jsx)(jn,{}):null}var gn,vn,On,wn=function(e){var n=e.handleSetDomForMap;return e.gameMap?Object(W.jsx)(W.Fragment,{children:e.gameMap.map((function(e,t){return Object(W.jsx)(hn,{children:e.map((function(e,r){return Object(W.jsx)("div",{ref:function(e){return n(t,r,e)},children:Object(W.jsx)(xn,{type:e.type})},r)}))},t)}))}):null},yn=s.a.div(gn||(gn=Object(u.a)(["\n  width: 2rem;\n  height: 2rem;\n  border-radius: 1rem;\n  border: 2px solid black;\n  position: absolute;\n  top: ","px;\n  left: ","px;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n"])),(function(e){return e.top}),(function(e){return e.left})),kn=s.a.div(vn||(vn=Object(u.a)(["\n  flex-grow: ",";\n  background-color: #FFF;\n"])),(function(e){return e.maxHp-e.hp})),Cn=s.a.div(On||(On=Object(u.a)(["\n  flex-grow: ",";\n  background-color: red;\n"])),(function(e){return e.hp}));var Mn=function(e){var n=e.roadMap,t=e.gameMap,r=e.monsters,c=e.hp,i=e.maxHp,a=e.speed,l=e.removeMonster,u=e.monsterId,s=o.a.useState(0),f=Object(A.a)(s,2),d=f[0],m=f[1],h=o.a.useState({top:0,left:0}),p=Object(A.a)(h,2),b=p[0],j=p[1],x=o.a.useRef(),g=o.a.useRef(null);return o.a.useEffect((function(){try{var e=n[d],r=e.x,o=e.y,c=t[o][r].dom,i=x.current,l=c.offsetTop+c.offsetHeight/2-i.offsetHeight/2,u=c.offsetLeft+c.offsetWidth/2-i.offsetWidth/2;0!==d?(i.style.transition="all ".concat(4e3/a,"ms linear"),j({top:l,left:u}),d+1<n.length&&null===g.current&&(g.current=setTimeout((function(){g.current=null,m(d+1)}),4e3/a))):(j({top:l,left:u}),setTimeout((function(){m(1)}),800))}catch(s){}}),[t,c,n,a,d]),o.a.useLayoutEffect((function(){0===c&&(clearTimeout(g.current),l(u))}),[c,u,l]),o.a.useEffect((function(){r.push({dom:x.current,id:u})}),[u,x,r]),Object(W.jsxs)(yn,Object(Ce.a)(Object(Ce.a)({ref:x,top:b.top,left:b.left},e),{},{children:[Object(W.jsx)(kn,{hp:c,maxHp:i}),Object(W.jsx)(Cn,{hp:c})]}))};var Sn,En,Rn=function(e){var n=e.gameMap,t=e.defaultRoadmap,r=e.monsters,o=e.monstersModel,c=e.removeMonster;return Object(W.jsx)(W.Fragment,{children:o.map((function(e,o){return Object(W.jsx)(Mn,{roadMap:t,gameMap:n,monsters:r,monsterId:e.id,hp:e.hp,maxHp:e.maxHp,speed:o+1,removeMonster:c},e.id)}))})},Fn={normal:{attack_range:200,name:"\u666e\u901a\u9632\u5fa1\u5854",attack_point:1}},In=s.a.div(Sn||(Sn=Object(u.a)(["\n  width: 2rem;\n  height: 2rem;\n  border-radius: 1rem;\n  border: 2px solid blue;\n  background-color: skyblue;\n  position: absolute;\n  top: ","px;\n  left: ","px;\n  z-index: 10;\n"])),(function(e){return e.top}),(function(e){return e.left})),Hn=s.a.div(En||(En=Object(u.a)(["\n  width: 8px;\n  height: 8px;\n  border-radius: 4px;\n  background-color: green;\n"])));var Tn=function(e){var n=e.towers,t=e.gameMap,r=e.coordinate,c=e.setCenterNode,i=e.type,a=e.monsters,l=e.requestFire,u=o.a.useRef(Date.now()),s=o.a.useRef(!0),f=o.a.useState({top:0,left:0}),d=Object(A.a)(f,2),m=d[0],h=d[1],p=o.a.useRef(),b=o.a.useCallback((function(){var e={x:p.current.offsetLeft+p.current.offsetWidth/2,y:p.current.offsetTop+p.current.offsetHeight/2};a.forEach((function(n){var t={x:n.dom.offsetLeft+n.dom.offsetWidth/2,y:n.dom.offsetTop+n.dom.offsetHeight/2};if(s.current&&Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)<Math.pow(Fn[i].attack_range+n.dom.offsetHeight/2,2)){var r=e,o=t,c={x:0,y:0};c.y=300*(o.y-r.y)/Math.pow(Math.pow(o.x-r.x,2)+Math.pow(o.y-r.y,2),.5)+r.y,c.x=(o.x-r.x)*(c.y-r.y)/(o.y-r.y)+r.x,l({source:e,target:c,component:Object(W.jsx)(Hn,{})}),s.current=!1,setTimeout((function(){return s.current=!0}),100)}}))}),[a,l,i]);return o.a.useEffect((function(){try{var e=r.x,n=r.y,o=t[n][e].dom,c=p.current;h({top:o.offsetTop+o.offsetHeight/2-c.offsetHeight/2,left:o.offsetLeft+o.offsetWidth/2-c.offsetWidth/2})}catch(i){}}),[r,t]),o.a.useEffect((function(){var e=setInterval(b,1e3/30);return function(){clearInterval(e)}}),[b]),Object(W.jsx)(In,Object(Ce.a)({top:m.top,left:m.left,ref:function(e){var t=!0;p.current=e,n.forEach((function(e){e.id===u.current&&(t=!1)})),t&&n.push({dom:e,id:u.current})},onMouseEnter:function(){return c({dom:p.current,type:i})},onMouseLeave:function(){return c(null)}},e))};var An,Wn=function(e){var n=e.towers,t=e.gameMap,r=e.towersModel,o=e.setCenterNode,c=e.monsters,i=e.requestFire;return Object(W.jsx)("div",{children:r.map((function(e){return Object(W.jsx)(Tn,{towers:n,monsters:c,type:e.type,requestFire:i,gameMap:t,setCenterNode:o,coordinate:e.coordinate},e.id)}))})},zn=s.a.div(An||(An=Object(u.a)(["\n  width: ","px;\n  height: ","px;\n  border-radius: 50%;\n  position: absolute;\n  background-color: rgba(135, 205, 235, 0.25);\n  top: ","px;\n  left: ","px;\n"])),(function(e){return 2*e.radius}),(function(e){return 2*e.radius}),(function(e){return e.top}),(function(e){return e.left}));var Ln=function(e){var n=e.centerNode,t=o.a.useState({top:0,left:0}),r=Object(A.a)(t,2),c=r[0],i=r[1],a=o.a.useRef();return o.a.useEffect((function(){try{var e=n.dom,t=a.current,r=e.offsetTop+e.offsetHeight/2-t.offsetHeight/2,o=e.offsetLeft+e.offsetWidth/2-t.offsetWidth/2;i({top:r,left:o})}catch(c){}}),[n]),null===n?null:Object(W.jsx)(zn,{top:c.top,left:c.left,ref:a,radius:Fn[n.type]?Fn[n.type].attack_range:0})};function Pn(e){return e/100<.75?1:1-4*(e/100-.75)}function Nn(e,n,t){var r,o=this;this.sourceCoordinate=e.source,this.targetCoordinate=e.target,e.process=void 0!==e.process?e.process+1.5:0,this.coordinate={x:(this.targetCoordinate.x-this.sourceCoordinate.x)*e.process/100+this.sourceCoordinate.x,y:(this.targetCoordinate.y-this.sourceCoordinate.y)*e.process/100+this.sourceCoordinate.y},!n.current.every((function(e){var n=e.dom.offsetLeft+e.dom.offsetWidth/2,t=e.dom.offsetTop+e.dom.offsetHeight/2,c=e.dom.offsetWidth/2;return r=e.id,Math.pow(n-o.coordinate.x,2)+Math.pow(t-o.coordinate.y,2)>Math.pow(c,2)}))&&(t(r),e.process=100),e.process>100&&(e.process=100),this.draw=function(n){n.beginPath(),n.fillStyle="rgba(0, 255, 0, ".concat(Pn(e.process),")"),n.arc(o.coordinate.x,o.coordinate.y,5,0,2*Math.PI,!1),n.strokeStyle="rgba(0, 0, 0, ".concat(Pn(e.process),")"),n.fill(),n.stroke()}}var Kn=function(e,n,t,r){e.style.position="absolute",e.width=window.innerWidth,e.height=window.innerHeight,e.style.zIndex=5;var o=e.getContext("2d");return setInterval((function(){return function(e,n,t,r){e.clearRect(0,0,window.innerWidth,window.innerHeight),n.forEach((function(o,c){100===o.process?n.splice(c,1):new Nn(o,t,r).draw(e)}))}(o,n,t,r)}),1e3/60)};var Jn,Dn=function(e){var n=e.bulletsModel,t=e.monsters,r=e.towerAttack;o.a.useEffect((function(){var e=Kn(c.current,n,t,r);return function(){clearInterval(e)}}),[n,t,r]);var c=o.a.useRef();return Object(W.jsx)("canvas",{ref:c})},Un=s.a.div(Jn||(Jn=Object(u.a)(["\n  width: 100vw;\n  height: 100vh;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n"])));var _n=function(){var e=o.a.useState([]),n=Object(A.a)(e,2),t=n[0],r=n[1],c=o.a.useRef([]),i=o.a.useState([{type:"normal",coordinate:{x:2,y:0},id:0}]),a=Object(A.a)(i,2),l=a[0],u=(a[1],o.a.useRef([])),s=o.a.useState([{type:"normal",id:0,hp:10,maxHp:10},{type:"normal",id:1,hp:10,maxHp:20},{type:"normal",id:2,hp:10,maxHp:10}]),f=Object(A.a)(s,2),d=f[0],m=f[1],h=function(){for(var e=[],n=0;n<9;n++)e.push({x:n,y:1});return e}(),p=o.a.useState(null),b=Object(A.a)(p,2),j=b[0],x=b[1],g=o.a.useRef([]).current,v=o.a.useRef(0);return o.a.useEffect((function(){r(function(){for(var e=[],n=0;n<3;n++){for(var t=[],r=0;r<9;r++)t.push({type:n%2===0?0:1});e.push(t)}return e}())}),[]),Object(W.jsxs)(Un,{children:[Object(W.jsx)(wn,{gameMap:t,handleSetDomForMap:function(e,n,o){var c=Object(mn.a)(t);c[e][n].dom||(c[e][n].dom=o,r(c))}}),Object(W.jsx)(Rn,{monsters:u.current,removeMonster:function(e){var n=Object(mn.a)(d),t=null;n.forEach((function(n,r){return n.id===e&&(t=r),!1})),null!==t&&(n.splice(t,1),m(n))},gameMap:t,defaultRoadmap:h,monstersModel:d}),Object(W.jsx)(Wn,{towers:c.current,monsters:u.current,towersModel:l,gameMap:t,requestFire:function(e){g.push(Object(Ce.a)(Object(Ce.a)({},e),{},{key:v.current++})),v.current>99999999&&(v.current=0)},setCenterNode:x}),Object(W.jsx)(Dn,{bulletsModel:g,cleanBullet:function(e){var n=Object(mn.a)(g),t=null;n.every((function(n,r){return n.key!==e||(t=r,!1)})),null!==t&&g.splice(t,1)},towerAttack:function(e){var n=Object(mn.a)(d);n.forEach((function(n){n.id===e&&--n.hp})),m(n)},monsters:u}),Object(W.jsx)(Ln,{centerNode:j})]})};var Bn=function(e){var n=e.width,t=void 0===n?window.innerWidth:n,r=e.height,c=void 0===r?window.innerHeight:r;return Object(W.jsx)("div",{children:o.a.Children.map(e.children,(function(e){return o.a.cloneElement(e,{width:t,height:c})}))})},qn=t(20);var Gn=function(e){var n=e.width,t=e.height,r=e.clear,c=void 0===r||r,i=e.fps,a=void 0===i?0:i,l=e.updateStackForLayer,u=void 0===l?null:l,s=e.renderOnMount,f=void 0===s||s,d=o.a.useRef(),m=o.a.useRef([]),h=o.a.useRef(0),p=o.a.useState(null),b=Object(A.a)(p,2),j=b[0],x=b[1];return o.a.useEffect((function(){if(null!==j){var e=function(){if(c&&j.clearRect(0,0,n,t),u){var e,r=Object(qn.a)(u.current);try{for(r.s();!(e=r.n()).done;){var o=e.value;h.current%o.frames===0&&o.func()}}catch(l){r.e(l)}finally{r.f()}}var i,a=Object(qn.a)(m.current);try{for(a.s();!(i=a.n()).done;){i.value.render(j)}}catch(l){a.e(l)}finally{a.f()}h.current++},r=0===a?null:setInterval(e,1e3/a);return f&&e(),function(){clearInterval(r)}}}),[c,j,a,t,f,u,n]),o.a.useEffect((function(){x(d.current.getContext("2d"))}),[]),Object(W.jsxs)(W.Fragment,{children:[Object(W.jsx)("canvas",{ref:d,width:n,height:t,style:{position:"absolute"}}),o.a.Children.map(e.children,(function(e){return o.a.cloneElement(e,{shapes:m.current,ctx:j,frameKey:h.current})}))]})};var Zn=function(e){var n=e.render,t=e.shapes,r=e.frameKey,c=o.a.useRef(null),i=o.a.useRef(Symbol("shape"));return o.a.useEffect((function(){var e=i.current;return t.push({render:n,shapeId:i.current}),c.current=r,function(){for(var n in t){t[n].shapeId===e&&t.splice(n,1)}}}),[r,n,t]),null};function Yn(e,n){if(e)return"function"===typeof e?e(n?n.current:null):e.current?e.current:e}var Qn=function(e){var n=e.shapes,t=e.frameKey,r=e.coordinate,c=e.size,i=e.color,a=e.type,l=void 0===a?"fill":a,u=e.lineWidth,s=void 0===u?1:u,f=o.a.useCallback((function(e){var n,t,o=Yn(r),a=Yn(c),u=Yn(i),f=o.x,d=o.y;if("number"===typeof a)n=a,t=a;else if("object"===typeof a){n=a.width,t=a.height}e&&("fill"===l?(e.fillStyle=u,e.fillRect(f,d,n,t),e.fillStyle="#000000"):"stroke"===l?(e.strokeStyle=u,e.lineWidth=s,e.strokeRect(f,d,n,t),e.lineWidth=1):"clear"===l&&e.clearRect(f,d,n,t))}),[r,c,l,i,s]);return Object(W.jsx)(Zn,{frameKey:t,render:f,shapes:n})};var $n=function(e){var n=e.shapes,t=e.ctx,r=e.frameKey;return o.a.Children.map(e.children,(function(e){return o.a.cloneElement(e,{shapes:n,ctx:t,frameKey:r})}))},Vn=function(){var e=o.a.useRef([]);return{registUpdateFunc:function(n){var t=n.func,r=n.frames,o=void 0===r?1:r,c=n.index,i=void 0===c?0:c,a=Symbol("updateFunc");if(0===e.current.length)e.current.push({key:a,func:t,frames:o,index:i});else{var l=0;e.current.every((function(n,t){return n.index<=i?(l=t,!1):(t===e.current.length-1&&(l=t),!0)})),e.current.splice(l,0,{key:a,func:t,frames:o,index:i})}return a},removeUpdateFunc:function(n){e.current.every((function(t,r){return t.key!==n||(e.current.splice(r,1),!1)}))},updateStackForLayer:e}};var Xn=function(e){var n=e.shapes,t=e.frameKey,r=e.coordinate,c=e.font,i=void 0===c?"16px YaHei":c,a=e.text,l=void 0===a?"":a,u=e.align,s=void 0===u?"":u,f=e.width,d=void 0===f?void 0:f,m=e.data,h=o.a.useCallback((function(e){if(""!==l){var n=Yn(r,m);e.font=Yn(i,m),e.textAlign=Yn(s,m),e.fillText(Yn(l,m),n.x,n.y,d),e.textAlign=null,e.font=null}}),[s,r,m,i,l,d]);return Object(W.jsx)(Zn,{frameKey:t,render:h,shapes:n})},et=[],nt=null,tt=function(){null!==nt&&clearInterval(nt),nt=setInterval((function(){var e,n=Object(qn.a)(et);try{for(n.s();!(e=n.n()).done;){(0,e.value)()}}catch(t){n.e(t)}finally{n.f()}}),1e3/60)};var rt=function(e){var n=e.row,t=e.column,r=e.data,c=e.coordinate,i=void 0===c?null:c,a=e.preview,l=void 0!==a&&a,u=i?i.x:window.innerWidth/2-150+30*t+2,s=i?i.y:window.innerHeight/2+30*n-300+2,f=o.a.useRef("");return o.a.useEffect((function(){var e;e=function(){var e=.15,o=l?t+3:t,c=l?n-3:n;1===r.gameModel.current[t][n].value?e=.5:r.fallingBlock.current.shape.forEach((function(n){n.row===c&&n.column===o&&(e=.5)})),f.current="rgba(0, 0, 0, ".concat(e,")")},et.push(e),null===nt&&tt()}),[t,r.fallingBlock,r.gameModel,l,n]),Object(W.jsxs)($n,Object(Ce.a)(Object(Ce.a)({},e),{},{children:[Object(W.jsx)(Qn,{type:"stroke",lineWidth:.5,coordinate:{x:u,y:s},size:26}),Object(W.jsx)(Qn,{type:"fill",color:f,lineWidth:.5,coordinate:{x:u,y:s},size:26})]}))},ot=function(){var e=new Map;e.set("I",[{row:0,column:3},{row:0,column:4},{row:0,column:5},{row:0,column:6}]);e.set("O",[{row:0,column:4},{row:-1,column:4},{row:0,column:5},{row:-1,column:5}]);e.set("J",[{row:0,column:3},{row:0,column:4},{row:0,column:5},{row:-1,column:3}]);e.set("L",[{row:0,column:3},{row:0,column:4},{row:0,column:5},{row:-1,column:5}]);e.set("S",[{row:0,column:3},{row:0,column:4},{row:-1,column:4},{row:-1,column:5}]);e.set("T",[{row:0,column:3},{row:0,column:4},{row:0,column:5},{row:-1,column:4}]);return e.set("Z",[{row:0,column:4},{row:0,column:5},{row:-1,column:3},{row:-1,column:4}]),function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"I";return{shape:JSON.parse(JSON.stringify(e.get(n))),offset:{row:0,col:0},key:n}}}(),ct=function(){var e=new Map;e.set("I",[[{row:0,column:3},{row:0,column:4},{row:0,column:5},{row:0,column:6}],[{row:0,column:4},{row:-1,column:4},{row:-2,column:4},{row:-3,column:4}]]);e.set("O",[[{row:0,column:4},{row:-1,column:4},{row:0,column:5},{row:-1,column:5}]]);e.set("J",[[{row:0,column:3},{row:0,column:4},{row:0,column:5},{row:-1,column:3}],[{row:0,column:4},{row:-1,column:4},{row:-2,column:4},{row:-2,column:5}],[{row:-1,column:3},{row:-1,column:4},{row:-1,column:5},{row:0,column:5}],[{row:0,column:5},{row:-1,column:5},{row:-2,column:5},{row:0,column:4}]]);e.set("L",[[{row:0,column:3},{row:0,column:4},{row:0,column:5},{row:-1,column:5}],[{row:0,column:4},{row:0,column:5},{row:-1,column:4},{row:-2,column:4}],[{row:-1,column:3},{row:-1,column:4},{row:-1,column:5},{row:0,column:3}],[{row:0,column:5},{row:-1,column:5},{row:-2,column:5},{row:-2,column:4}]]);e.set("S",[[{row:0,column:3},{row:0,column:4},{row:-1,column:4},{row:-1,column:5}],[{row:0,column:5},{row:-1,column:5},{row:-1,column:4},{row:-2,column:4}]]);e.set("T",[[{row:0,column:3},{row:0,column:4},{row:0,column:5},{row:-1,column:4}],[{row:-2,column:4},{row:-1,column:4},{row:0,column:4},{row:-1,column:5}],[{row:-1,column:3},{row:-1,column:4},{row:-1,column:5},{row:0,column:4}],[{row:-2,column:4},{row:-1,column:4},{row:0,column:4},{row:-1,column:3}]]);return e.set("Z",[[{row:0,column:4},{row:0,column:5},{row:-1,column:3},{row:-1,column:4}],[{row:0,column:4},{row:-1,column:4},{row:-1,column:5},{row:-2,column:5}]]),function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"I";return{group:JSON.parse(JSON.stringify(e.get(n))),point:0}}}(),it=["I","O","J","L","S","T","Z"],at=null,lt=null,ut=function(){if(null!==at){var e=at;return at=null,null!==lt&&lt(),e}return it[Math.floor(Math.random()*it.length)]},st=0,ft=function(){st=0},dt=Object(d.b)({name:"cube",initialState:{state:0},reducers:{setState:function(e,n){e.state=n.payload}}}),mt=dt.actions.setState,ht=dt.reducer,pt=!1,bt=function(){return pt};function jt(){for(var e=[],n=0;n<10;n++){for(var t=[],r=0;r<20;r++){t.push({value:0})}e.push(t)}return e}var xt=function(e){var n=o.a.useRef(jt()),t=o.a.useRef([]),r=o.a.useRef({}),c=Object(f.b)(),i=Object(f.c)((function(e){return e.cube.state})),a=o.a.useCallback((function(){n.current=jt();var e=ut();t.current=ot(e),r.current=ct(e),c(mt(1))}),[c]);return o.a.useEffect((function(){var e=function e(o){if("left"===o){var i=!0;t.current.shape.forEach((function(e){(0===e.column||n.current[e.column-1][e.row]&&0!==n.current[e.column-1][e.row].value)&&(i=!1)})),i&&(t.current.shape.forEach((function(e){e.column--})),t.current.offset.col--)}else if("right"===o){var a=!0;t.current.shape.forEach((function(e){(9===e.column||n.current[e.column+1][e.row]&&0!==n.current[e.column+1][e.row].value)&&(a=!1)})),a&&(t.current.shape.forEach((function(e){e.column++})),t.current.offset.col++)}else{if("down"===o){var l,u=[],s=[];if(t.current.shape.forEach((function(e){l=e.row<0||e.row<19&&0===n.current[e.column][e.row+1].value&&-1!==l?0:-1})),0===l&&t.current.offset.row++,t.current.shape.forEach((function(e){0===l?e.row++:(n.current[e.column][e.row].value=1,u.push(e.row))})),-1===l){var f=ut();w=t.current.shape.length,st+=10*w,t.current=ot(f),r.current=ct(f),t.current.shape.forEach((function(e){n.current[e.column][e.row]&&1===n.current[e.column][e.row].value&&c(mt(-1))}))}u.forEach((function(e){n.current.every((function(n){return 1===n[e].value}))&&s.push(e)})),s=Array.from(new Set(s)).sort((function(e,n){return e-n}));for(var d=0;d<s.length;d++)for(var m=s[d],h=0;h<n.current.length;h++)n.current[h].splice(m,1),n.current[h].unshift({value:0});return function(e){0!==e&&(st+=100*Math.pow(2,e-1))}(s.length),l}if("up"===o){var p=r.current.point,b=p,j=r.current.group,x=t.current.offset,g=n.current;p===j.length-1?p=0:p++,r.current.point=p;var v=JSON.parse(JSON.stringify(j[p])),O=!0;v.forEach((function(e){e.row+=x.row,e.column+=x.col,(e.column<0||e.column>9||g[e.column][e.row]&&1===g[e.column][e.row].value)&&(O=!1)})),O?t.current.shape=v:r.current.point=b}else if("space"===o)for(;-1!==e("down"););}var w},o=function(){var e=bt();pt=!e};document.onkeydown=function(n){var t=bt();if(1===i)switch(n.code){case"ArrowRight":!t&&e("right");break;case"ArrowLeft":!t&&e("left");break;case"ArrowUp":!t&&e("up");break;case"ArrowDown":!t&&e("down");break;case"Space":!t&&e("space");break;case"KeyP":o();break;default:return}else if(-1===i)switch(n.code){case"Space":a(),ft();break;case"Escape":c(mt(0)),ft()}};var l=ut();t.current=ot(l),r.current=ct(l);var u=setInterval((function(){var n=bt();1!==i||n||e("down"),-1===i&&clearInterval(u)}),750);return function(){return clearInterval(u)}}),[c,a,i]),Object(W.jsx)($n,Object(Ce.a)(Object(Ce.a)({},e),{},{children:jt().map((function(e,r){return e.map((function(e,o){return Object(W.jsx)(rt,{column:r,row:o,data:{gameModel:n,fallingBlock:t}})}))}))}))};function gt(){for(var e=[],n=0;n<4;n++){for(var t=[],r=0;r<4;r++){t.push({value:0})}e.push(t)}return e}var vt=function(e){var n=window.innerWidth/2+202,t=window.innerHeight/2-242,r=o.a.useRef(gt()),c=o.a.useRef([]),i=Object(f.c)((function(e){return e.cube.state}));o.a.useEffect((function(){var e=function(){var e=ut();!function(e){at=e}(e),c.current=ot(e)};e(),function(e){lt=e}(e)}),[]);var a=-1!==i?"State: ".concat(bt()?"Pause":"Play"):"State: Game Over",l=-1!==i?"Press key 'P' to ".concat(bt()?"containue":"pause"):"'Space': new game.",u=-1===i?"'ESC': back to menu.":"";return Object(W.jsxs)($n,Object(Ce.a)(Object(Ce.a)({},e),{},{children:[Object(W.jsx)(Qn,{type:"stroke",coordinate:{x:n,y:t},size:{width:124,height:124}}),Object(W.jsx)(Qn,{type:"fill",color:"rgba(0, 0, 0, 0.1)",coordinate:{x:n,y:t},size:{width:124,height:124}}),Object(W.jsx)(Xn,{coordinate:{x:n+61,y:t-20},text:"Next Item"}),gt().map((function(e,o){return e.map((function(e,i){return Object(W.jsx)(rt,{column:o,preview:!0,row:i,data:{gameModel:r,fallingBlock:c},coordinate:{x:4+n+30*o,y:4+t+30*i}},"[".concat(i,", ").concat(o,"]"))}))})),Object(W.jsx)(Xn,{coordinate:{x:n+61,y:t+220},text:"Score",font:"24px YaHei",width:200,align:"center"}),Object(W.jsx)(Xn,{coordinate:{x:n+61,y:t+255},text:function(){return st},width:200,align:"center"}),Object(W.jsx)(Xn,{coordinate:{x:n+61,y:t+335},text:a,font:"24px YaHei",width:200,align:"center"}),Object(W.jsx)(Xn,{coordinate:{x:n+61,y:t+365},text:l,align:"center"}),Object(W.jsx)(Xn,{coordinate:{x:n+61,y:t+385},text:u,align:"center"})]}))};function Ot(e){var n=window.innerWidth/2-152,t=window.innerHeight/2-302;return Object(W.jsxs)($n,Object(Ce.a)(Object(Ce.a)({},e),{},{children:[Object(W.jsx)(Qn,{type:"stroke",coordinate:{x:n,y:t},size:{width:304,height:604}}),Object(W.jsx)(Qn,{type:"fill",color:"rgba(0, 0, 0, 0.1)",coordinate:{x:n,y:t},size:{width:304,height:604}})]}))}var wt,yt,kt=function(){var e=o.a.useRef({x:0,y:0}),n=o.a.useRef(0),t=Vn(),r=t.updateStackForLayer,c=t.registUpdateFunc,i=t.removeUpdateFunc;return o.a.useEffect((function(){var t=c({func:function(){e.current.y++,e.current.x++,n.current++},frames:1,index:0});setTimeout((function(){i(t)}),3e3)}),[c,i]),Object(W.jsx)(W.Fragment,{children:Object(W.jsxs)(Bn,{children:[Object(W.jsx)(Gn,{fps:1,children:Object(W.jsx)(Ot,{})}),Object(W.jsxs)(Gn,{updateStackForLayer:r,fps:30,children:[Object(W.jsx)(xt,{}),Object(W.jsx)(vt,{})]})]})})},Ct=s.a.div(wt||(wt=Object(u.a)(["\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n"]))),Mt=s.a.div(yt||(yt=Object(u.a)(["\n  width: 12rem;\n  height: 4rem;\n  margin: 1rem;\n  background-color: rgba(0, 0, 0, 0.15);\n  border: 4px solid rgba(0, 0, 0, 0.5);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border-radius: 2rem;\n"])));var St=function(e){var n=Object(f.b)();return Object(W.jsxs)(Ct,{children:[Object(W.jsx)("h1",{children:"E LUO SI FANG KUAI"}),Object(W.jsx)(Mt,{onClick:function(){n(mt(1))},children:"Game Start"}),Object(W.jsx)(Mt,{children:"Help"})]})};var Et,Rt=function(e){return 0===Object(f.c)((function(e){return e.cube.state}))?Object(W.jsx)(St,{}):Object(W.jsx)(kt,{})},Ft=[{title:"\u7a7a\u5f53\u63a5\u9f99",link:"/cells",component:Object(W.jsxs)(W.Fragment,{children:[Object(W.jsx)(dn,{}),Object(W.jsx)(rn,{})]})},{title:"\u5854\u9632\u6e38\u620f",link:"/towerdefense",component:Object(W.jsx)(_n,{})},{title:"\u4fc4\u7f57\u65af\u65b9\u5757",link:"/russia-cube",component:Object(W.jsx)(Rt,{})}],It=s.a.div(Et||(Et=Object(u.a)(["\n  width: 10rem;\n  height: 10rem;\n  background-color: white;\n  box-shadow: 0 0 4px 1px lightgray;\n  border-radius: 4px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  color: black;\n  margin: 0 0.5rem;\n  &:hover {\n    box-shadow: 0 0 6px 2px lightgray;\n    cursor: pointer;\n  }\n  @media(max-width: 768px) {\n    width: 44vw;\n    margin: 0;\n  }\n"])));var Ht,Tt,At,Wt,zt=function(e){return Object(W.jsx)(It,Object(Ce.a)({},e))},Lt=s.a.div(Ht||(Ht=Object(u.a)(["\n  min-height: 100vh;\n  background-color: whitesmoke;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n"]))),Pt=s.a.div(Tt||(Tt=Object(u.a)(["\n  @media (min-width: 1180px) {\n    width: 1180px;\n    padding: 0;\n  }\n  width: 100vw;\n  padding: 0 1rem;\n  box-sizing: border-box;\n"]))),Nt=s.a.div(At||(At=Object(u.a)(["\n  width: 100%;\n  display: flex;\n  justify-content: flex-start;\n  align-items: center;\n  @media (max-width: 768px) {\n    justify-content: space-between;\n  }\n"]))),Kt=s.a.h1(Wt||(Wt=Object(u.a)(["\n  margin: 0;\n  padding: 1rem 0;\n"])));var Jt=function(){return Object(W.jsx)(Lt,{children:Object(W.jsxs)(Pt,{children:[Object(W.jsx)(Kt,{children:"- Game List"}),Object(W.jsx)(Nt,{children:Ft.map((function(e){return Object(W.jsx)(a.b,{to:"/html-games"+e.link,style:{textDecoration:"none"},children:Object(W.jsx)(zt,{children:e.title})},e.title)}))})]})})};var Dt=function(){return Object(W.jsx)(a.a,{children:Object(W.jsxs)(l.c,{children:[Ft.map((function(e){return Object(W.jsx)(l.a,{path:"/html-games"+e.link,children:e.component},e.title)})),Object(W.jsx)(l.a,{exact:!0,path:"/html-games",children:Object(W.jsx)(Jt,{})})]})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ut=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,47)).then((function(n){var t=n.getCLS,r=n.getFID,o=n.getFCP,c=n.getLCP,i=n.getTTFB;t(e),r(e),o(e),c(e),i(e)}))},_t=Object(d.a)({reducer:{cells:T,cube:ht}});i.a.render(Object(W.jsx)(o.a.StrictMode,{children:Object(W.jsx)(f.a,{store:_t,children:Object(W.jsx)(Dt,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)})),Ut()}},[[46,1,2]]]);
//# sourceMappingURL=main.64c20f63.chunk.js.map